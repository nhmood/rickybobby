<%- include('partials/_head'); %>
<body>
  <div class="container">
    <%- include('partials/_header'); %>


    <div id="main" class="row">
      <div class="row header">
        <h1>Shake and Bake</h1>
      </div>



      <div class="row component user_info">
        <div class="five columns user userA">

          <div class="row details">
            <div class="ten columns">
              <div class="row username"><%= userA.data.username %></div>
              <div class="row location"><%= userA.data.location %></div>
            </div>
            <div class="two columns">
              <a href="/users/<%= userA.data.username %>">
                <img class="profile u-full-width" src="<%= userA.data.image_url %>"></img>
              </a>
            </div>
          </div><!-- details -->

          <div class="row score">
            <%= summary.data.wins[userA.data.id] %>
            <% if(summary.data.winner[userA.data.id]){ %>
              ðŸ”¥
            <% } %>
          </div><!-- score -->
        </div><!-- userA -->

        <div class="two columns vs">VS</div>


        <div class="five columns user userB">
          <div class="row details">
            <div class="two columns">
              <a href="/users/<%= userB.data.username %>">
                <img class="profile u-full-width" src="<%= userB.data.image_url %>"></img>
              </a>
            </div>
            <div class="ten columns">
              <div class="row username"><%= userB.data.username %></div>
              <div class="row location"><%= userB.data.location %></div>
            </div>
          </div><!-- details -->

          <div class="row score">
            <%= summary.data.wins[userB.data.id] %>
            <% if(summary.data.winner[userB.data.id]){ %>
              ðŸ”¥
            <% }; %>
          </div><!-- score -->
        </div><!-- details -->
      </div><!-- user_info -->


      <div class="row workouts">
        <div class="row header">
          <h2>Workouts</h2>

          <% rides.data.forEach(function(ride){ %>
              <div class="row comparison component">
              <div class="row ride-details">
              <div class="row ride-image">
                  <img class="u-full-width" src="<%= ride.instructor.image_url %>"></img>
                </div><!-- ride-image -->

                <div class="row ride-name"><%= ride.ride.title %></div>
                <div class="row ride-instructor"><%= ride.instructor.name %></div>
              </div><!-- ride-details -->

              <div class="row workout-details">
                <div class="six columns userA">
                  <% best = ride.users[userA.data.id].workouts[0] %>
                  <div class="row">
                    <img class="comparison-profile u-full-width" src="<%= userA.data.image_url %>"></img>
                    <% console.log(best) %>
                    <% if (ride.users[userA.data.id].winner){ %>
                      âœ…
                    <% }; %>
                  </div>

                    <div class="row workout-output">Output: <%= best.total_output %></div>
                    <div class="row workout-taken">Taken: <%= new Date(best.taken_at * 1000) %></div>

                    <div class="workout-metrics">
                      <div class="row workout-max-output">Max Output: <%= best.max_output %></div>
                      <div class="row workout-cadence">Cadence (avg/max): <%= best.avg_cadence %> / <%= best.max_cadence %></div>
                      <div class="row workout-resistance">Resistance (avg/max): <%= best.avg_resistance %> / <%= best.max_resistance %></div>
                      <div class="row workout-speed">Speed (avg/max): <%= best.avg_speed %> / <%= best.max_speed %></div>
                    </div>
                </div>


                <div class="six columns userB">
                  <% best = ride.users[userB.data.id].workouts[0] %>
                  <div class="row">
                    <img class="comparison-profile u-full-width" src="<%= userB.data.image_url %>"></img>
                    <% if (ride.users[userB.data.id].winner){ %>
                      âœ…
                    <% }; %>
                  </div>

                    <div class="row workout-output">Output: <%= best.total_output %></div>
                    <div class="row workout-taken">Taken: <%= new Date(best.taken_at * 1000) %></div>

                    <div class="workout-metrics">
                      <div class="row workout-max-output">Max Output: <%= best.max_output %></div>
                      <div class="row workout-cadence">Cadence (avg/max): <%= best.avg_cadence %> / <%= best.max_cadence %></div>
                      <div class="row workout-resistance">Resistance (avg/max): <%= best.avg_resistance %> / <%= best.max_resistance %></div>
                      <div class="row workout-speed">Speed (avg/max): <%= best.avg_speed %> / <%= best.max_speed %></div>
                    </div>
                </div>


              </div><!-- workout-details -->
            </div><!-- comparison -->










          <% }); %>
        </div>
      </div><!-- workouts -->

    </div><!-- main -->
  </div><!-- container -->
</body>


<pre class="hide" data-type="userA">
  <%= userA.debug %>
</pre>
<pre class="hide" data-type="userB">
  <%= userB.debug %>
</pre>
<pre class="hide" data-type="summary">
  <%= summary.debug %>
</pre>
<pre class="hide" data-type="rides">
  <%= rides.debug %>
</pre>

<script>
  let debug = document.getElementsByTagName("pre");
  let data = Array.from(debug).reduce((result, item) => {
    let type =item.dataset.type;
    result[type] = JSON.parse(item.innerHTML);
    return result;
  }, {})
</script>


<%- include('partials/_end'); %>
